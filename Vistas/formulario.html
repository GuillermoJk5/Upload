<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Sospechoso</title>
  <link rel="stylesheet" href="../Estilos/formulario.css">
  <link rel="stylesheet" href="../Estilos/estilos.css">
</head>
<body>
  <header>
    <button class="alert" id="mostrarImagen">Alert</button>
  </header>
  
  <h1>Formulario de Sospechosos</h1>
  <button onclick="ira('Principal.html')">Volver</button>
  
  <form id="sospechosoForm">
    <input type="hidden" disabled id="id" value="0">
    <label for="nombreInput">Nombre:</label>
    <input type="text" id="nombreInput" required><br><br>

    <label>Tipo:</label>
    <div class="radio-container">
      <input type="radio" id="tipoCargado" name="tipoSospechoso" value="Cargado" required>
      <label for="tipoCargado">Cargado</label>

      <input type="radio" id="tipoVivo" name="tipoSospechoso" value="Vivo" required>
      <label for="tipoVivo">Vivo</label>
    </div><br>

    <label for="residenciaInput">Residencia:</label>
    <input type="text" id="residenciaInput" required><br>

    <label for="fechaDescargaInput" id="fechaDescargaLabel" style="display: none;">Fecha de Descarga:</label>
    <input type="date" id="fechaDescargaInput" style="display: none;"><br>

    <label for="culpabilidadInput">Culpabilidad:</label>
    <select id="culpabilidadInput" required>
      <option value="" disabled selected>Seleccione una culpabilidad</option>
      <option value="Posible_cooperador">Posible cooperador</option>
      <option value="Cooperador">Cooperador</option>
      <option value="Delincuente">Delincuente</option>
    </select><br><br>

    <label for="imagenInput">URL Imagen:</label>
    <input type="text" id="imagenInput" required><br><br>

    <label for="comentarioInput">Comentario:</label>
    <textarea id="comentarioInput" rows="6" cols="50" style="resize: none;" required></textarea><br><br>

    <input type="submit" value="Guardar Sospechoso">
  </form>
  
  <div class="fullscreen" id="imagenFullscreen">
    <img class='imggrande' src="https://www.es.kayak.com/rimg/himg/e8/ab/bc/hotelsdotcom-703824352-6f2b45f3_w-054994.jpg?width=1366&height=768&xhint=1000&yhint=720&crop=true" alt="Imagen a pantalla completa">
  </div>

  <script src="../Modelos/Sospechoso.js"></script>
  <script src="../Controladores/funciones.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('tipoCargado').addEventListener('click', mostrarFechaDescarga);
      document.getElementById('tipoVivo').addEventListener('click', ocultarFechaDescarga);
    });
  
    const urlParams = new URLSearchParams(window.location.search);
    const sujetoJSON = urlParams.get('sujeto');
    const sujeto = JSON.parse(decodeURIComponent(sujetoJSON));
console.log(sujeto);
    if(sujeto!=null){
  
    document.getElementById('id').value = sujeto._id;
    document.getElementById('nombreInput').value = sujeto._nombre;
    document.getElementById('residenciaInput').value = sujeto._residencia;
    document.getElementById('culpabilidadInput').value = sujeto._culpabilidad;
    document.getElementById('imagenInput').value = sujeto._imagen;
    document.getElementById('comentarioInput').value = sujeto._comentario;
  
    fecha = sujeto._fecha;
    if (fecha != null) {
      mostrarFechaDescarga();
      document.getElementById('fechaDescargaInput').value = fecha;
    }
  
    if (sujeto._tipo == 'Cargado') {
      document.getElementById('tipoCargado').checked = true;
    } else {
      document.getElementById('tipoVivo').checked = true;
    }
  }
  
    function ocultarFechaDescarga() {
      const fechaDescargaLabel = document.getElementById('fechaDescargaLabel');
      const fechaDescargaInput = document.getElementById('fechaDescargaInput');
      fechaDescargaLabel.style.display = 'none';
      fechaDescargaInput.style.display = 'none';
    }
  
    document.getElementById('sospechosoForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const fechaDescarga = document.getElementById('fechaDescargaInput').value;
  
      if (validarFechaCampo()) {
        const id = document.getElementById('id').value;
        const nombre = document.getElementById('nombreInput').value;
        const tipoCargadoChecked = document.getElementById('tipoCargado').checked;
        const residencia = document.getElementById('residenciaInput').value;
        const culpabilidad = document.getElementById('culpabilidadInput').value;
        const imagen = document.getElementById('imagenInput').value;
        const comentario = document.getElementById('comentarioInput').value;
  
        let tipo = tipoCargadoChecked ? 'Cargado' : 'Vivo';
  
        const nuevoSospechoso = new Sospechoso(id, nombre, tipo, residencia, fechaDescarga, culpabilidad, imagen, comentario);
        console.log(nuevoSospechoso);
        anadirSospechoso(nuevoSospechoso);
        limpiarCampos();
      } else {
        alert("Error en la fecha");
      }
    });
  
    function validarFechaCampo() {
      const fecha = 'fechaDescargaInput';
  
      if (!fecha || fecha === '') {
        return true;
      } else {
        const fechaCampo = new Date(document.getElementById(fecha).value);
        const fechaActual = new Date();
  
        if (fechaCampo > fechaActual) {
          return false;
        } else {
          return true;
        }
      }
    }
  
    function anadirSospechoso(nuevoSospechoso) {
      let listaSospechosos = [];
  
      const listaSospechososJSON = localStorage.getItem('sospechosos');
      if (listaSospechososJSON) {
        listaSospechosos = JSON.parse(listaSospechososJSON);
      }
  
      if (nuevoSospechoso._id > 0) {
        listaSospechosos.forEach(sospechoso => {
          if (sospechoso._id == nuevoSospechoso._id) {
            sospechoso = nuevoSospechoso;
          }
        });
      } else {

        numero = listaSospechosos.length;
        console.log(listaSospechosos);
        console.log(numero);
        nuevoSospechoso._id = numero +1;

        listaSospechosos.push(nuevoSospechoso);
        console.log(nuevoSospechoso);
      }
  
      const nuevaListaSospechososJSON = JSON.stringify(listaSospechosos);
      localStorage.setItem('sospechosos', nuevaListaSospechososJSON);
    }
  
    function mostrarFechaDescarga() {
      const fechaDescargaLabel = document.getElementById('fechaDescargaLabel');
      const fechaDescargaInput = document.getElementById('fechaDescargaInput');
      fechaDescargaLabel.style.display = 'block';
      fechaDescargaInput.style.display = 'block';
    }
  
    function limpiarCampos() {
      document.getElementById('nombreInput').value = '';
      document.getElementById('tipoCargado').checked = false;
      document.getElementById('tipoVivo').checked = false;
      document.getElementById('residenciaInput').value = '';
      document.getElementById('fechaDescargaInput').value = '';
      document.getElementById('culpabilidadInput').selectedIndex = 0;
      document.getElementById('imagenInput').value = '';
      document.getElementById('comentarioInput').value = '';
      // ira("Principal.html");
    }
  
  </script>
  <script src="../Controladores/principal.js"></script>
  
</body>
</html>


